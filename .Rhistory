Pta[,"all"] <- paste(Pta$Sample,Pta$Specie,Pta$Soil, sep = ".")
df2 <- as.data.frame(c(aggregate(SR~all, FUN=function(x) c(mean = mean(x), sd = sd(x)), data = Pta),(aggregate(shannon_div~all, FUN=function(x) c(mean = mean(x), sd = sd(x)), data = Pta)),(aggregate(even~all, FUN=function(x) c(mean = mean(x), sd = sd(x)), data = Pta))))
df2 <- df2 %>% dplyr::select(all,SR.mean, SR.sd, shannon_div.mean, shannon_div.sd, even.mean, even.sd)
rownames(df2) <- df2$all
df2 <- df2[-1]
df <- rbind(df,df2)
df$SR.mean <- round(df$SR.mean, digits = 2)
df$shannon_div.mean <- round(df$shannon_div.mean, digits = 2)
df$even.mean <- round(df$even.mean, digits = 2)
df$SR.sd <- round(df$SR.sd, digits = 3)
df$shannon_div.sd <- round(df$shannon_div.sd, digits = 3)
df$even.sd <- round(df$even.sd, digits = 3)
df
#write.csv(df,"Manuscript/Plots/Supplementary/Bacterial_richness_alpha.csv")
#Soil
ord <- ordinate(subset_samples(phy_raref, Sample == "Soil"), method = "PCoA", distance = "bray", weighted=FALSE)
sample_data(phy_norm)[,"Specie_sample"] <- paste(sample_data(phy_norm)$Specie,sample_data(phy_norm)$Sample, sep="-")
plot1<- gg_ordiplot(ord$vectors, groups = sample_data(subset_samples(phy_norm, Sample == "Soil"))$Soil, hull = TRUE,
label = TRUE, spiders = TRUE, ellipse = FALSE, pt.size = 7, plot = FALSE)
ggplot(data=plot1$df_spiders) +
geom_point(aes(x=x, y=y,shape=Group, colour=Group), size = 5) +
geom_point(aes(x=cntr.x, y=cntr.y), size = 5, shape = 18) +
scale_color_manual(values=c("gold", "darkorange", "brown", "darkgoldenrod3")) + scale_shape_manual(values = c(19,19,19,19)) +
theme_bw() +
theme(legend.position = "bottom", legend.box = "vertical",
text=element_text(size = 18),
axis.text.x = element_text(size = 16, colour = "black"),
axis.text.y = element_text(size = 16, colour = "black"),
panel.border = element_rect(size = 2, fill = NA))
phy_obj_B_Soil <- subset_samples(phy_obj_Bacteria, Sample == "Soil")
phy_obj_B_Soil <- subset_samples(phy_obj_B_Soil, Soil != "Pozo_Almonte")
sample_data(phy_obj_B_Soil)[,"sample_site"] <- paste(sample_data(phy_obj_B_Soil)$Sample, sample_data(phy_obj_B_Soil)$Soil, sep = "_")
phy_norm_B_Soil <- subset_samples(phy_norm, Sample == "Soil")
phy_norm_B_Soil <- subset_samples(phy_norm_B_Soil, Soil != "Pozo_Almonte")
sample_data(phy_norm_B_Soil)[,"sample_site"] <- paste(sample_data(phy_norm_B_Soil)$Sample, sample_data(phy_norm_B_Soil)$Soil, sep = "_")
phy_raref_B_Soil <- subset_samples(phy_raref, Sample == "Soil")
phy_raref_B_Soil <- subset_samples(phy_raref_B_Soil, Soil != "Pozo_Almonte")
sample_data(phy_raref_B_Soil)[,"sample_site"] <- paste(sample_data(phy_raref_B_Soil)$Sample, sample_data(phy_raref_B_Soil)$Soil, sep = "_")
#Root
phy_obj_B_Root <- subset_samples(phy_obj_Bacteria, Sample == "Root")
phy_norm_B_Root <- subset_samples(phy_norm, Sample == "Root")
phy_raref_B_Root <- subset_samples(phy_raref, Sample == "Root")
sample_data(phy_obj_B_Root)[,"sample_site"] <- paste(sample_data(phy_obj_B_Root)$Sample, sample_data(phy_obj_B_Root)$Soil, sample_data(phy_obj_B_Root)$Specie, sep = "_")
sample_data(phy_norm_B_Root)[,"sample_site"] <- paste(sample_data(phy_norm_B_Root)$Sample, sample_data(phy_norm_B_Root)$Soil, sample_data(phy_norm_B_Root)$Specie, sep = "_")
sample_data(phy_raref_B_Root)[,"sample_site"] <- paste(sample_data(phy_raref_B_Root)$Sample, sample_data(phy_raref_B_Root)$Soil, sample_data(phy_raref_B_Root)$Specie, sep = "_")
phy_obj2 <- merge_phyloseq(phy_obj_B_Soil,phy_obj_B_Root)
phy_norm2 <- merge_phyloseq(phy_norm_B_Soil,phy_norm_B_Root)
phy_raref2 <- merge_phyloseq(phy_raref_B_Soil,phy_raref_B_Root)
ord <- ordinate(phy_raref2, method = "PCoA", distance = "bray", weighted=FALSE)
plot_ordination(phy_norm2, ord, color = "Soil", shape = "sample_site") + geom_point(size=7) +
scale_color_manual(values=c("gold", "darkorange", "darkgoldenrod3")) + scale_shape_manual(values = c(24,25,24,25,24,25,19,19,19,19)) +
theme_bw() +
theme(legend.position = "bottom", legend.box = "vertical",
text=element_text(size = 18),
axis.text.x = element_text(size = 16, colour = "black"),
axis.text.y = element_text(size = 16, colour = "black"),
panel.border = element_rect(size = 2, fill = NA))
plot1<- gg_ordiplot(ord$vectors, groups = sample_data(phy_norm2)$sample_site, hull = TRUE,
label = TRUE, spiders = TRUE, ellipse = FALSE, pt.size = 7, plot = FALSE)
#pdf("Manuscript/Plots/Fungal_beta_Both.pdf",height=10, width=10)
ggplot(data=plot1$df_spiders) +
geom_point(aes(x=x, y=y,shape=Group, colour=Group), size = 5) +
geom_point(aes(x=cntr.x, y=cntr.y), size = 5, shape = 18) +
scale_color_manual(values=c("gold","gold", "darkorange","darkorange", "darkgoldenrod3","darkgoldenrod3","gold", "darkorange", "darkgoldenrod3")) + scale_shape_manual(values = c(24,25,24,25,24,25,19,19,19,19)) +
theme_bw() +
theme(legend.position = "bottom", legend.box = "vertical",
text=element_text(size = 18),
axis.text.x = element_text(size = 16, colour = "black"),
axis.text.y = element_text(size = 16, colour = "black"),
panel.border = element_rect(size = 2, fill = NA))
#dev.off()
(sim <- with(sample_data(subset_samples(phy_obj2, Sample == "Root")), simper(t(otu_table(subset_samples(phy_obj2, Sample == "Root"))), sample_site)))
#summary(sim)
tmp <- prune_samples(!is.na(sample_data(phy_obj2)$Specie), phy_obj2)
adonis(t(otu_table(tmp)) ~ Specie * Sample * Soil, data = data.frame(sample_data(phy_obj2)))
#pairwise.adonis(t(otu_table(tmp)),data.frame(sample_data(phy_obj2))$Specie)
#pairwise.adonis(t(otu_table(tmp)),data.frame(sample_data(phy_obj2))$Sample)
#pairwise.adonis(t(otu_table(tmp)),data.frame(sample_data(phy_obj2))$Soil)
#pairwise.adonis(t(otu_table(tmp)),paste(data.frame(sample_data(phy_obj2))$Specie,data.frame(sample_data(phy_obj2))$Sample,sep = "."))
#pairwise.adonis(t(otu_table(tmp)),paste(data.frame(sample_data(phy_obj2))$Specie,data.frame(sample_data(phy_obj2))$Soil,sep = "."))
#pairwise.adonis(t(otu_table(tmp)),paste(data.frame(sample_data(phy_obj2))$Specie,data.frame(sample_data(phy_obj2))$Sample, data.frame(sample_data(phy_obj2))$Soil,sep = "."))
# Preparing data
taxonomy2 <- data.frame(paste(tax_table(subset_samples(phy_norm, Sample == "Soil"))[,1],tax_table(subset_samples(phy_norm, Sample == "Soil"))[,2],tax_table(subset_samples(phy_norm, Sample == "Soil"))[,3],tax_table(subset_samples(phy_norm, Sample == "Soil"))[,4],
tax_table(subset_samples(phy_norm, Sample == "Soil"))[,5],tax_table(subset_samples(phy_norm, Sample == "Soil"))[,6],tax_table(subset_samples(phy_norm, Sample == "Soil"))[,7],sep = ";"))
rownames(taxonomy2) <- rownames(tax_table(subset_samples(phy_norm, Sample == "Soil")))
colnames(taxonomy2) <- "taxonomy"
taxonomy2[,"ASV"] <- rownames(taxonomy2)
sim <- with(sample_data(subset_samples(phy_obj_Bacteria, Sample == "Soil")), simper(t(otu_table(subset_samples(phy_obj_Bacteria, Sample == "Soil"))), Soil))
#summary(sim)
df1 <- rownames(summary(sim)[[1]] %>% filter(cumsum < .7)) #LS_V
df2 <- rownames(summary(sim)[[2]] %>% filter(cumsum < .7)) #LS_PA
df3 <- rownames(summary(sim)[[3]] %>% filter(cumsum < .7)) #LS_LA
df4 <- rownames(summary(sim)[[4]] %>% filter(cumsum < .7)) #V_PA
df5 <- rownames(summary(sim)[[5]] %>% filter(cumsum < .7)) #V_LA
df6 <- rownames(summary(sim)[[6]] %>% filter(cumsum < .7)) #PA_LA
union(union(df2,df4),df6) #all ASV's that makes PA different
intersect(intersect(df2,df4),df6) #common ASV's that makes PA different
union(union(df3,df5),df6) #all ASV's that makes LA different
intersect(intersect(df3,df5),df6) #common ASV's that makes LA different
union(union(df1,df2),df3) #all ASV's that makes LS different
intersect(intersect(df1,df2),df3) #common ASV's that makes LS different
union(union(df1,df4),df5) #all ASV's that makes V different
intersect(intersect(df1,df4),df5) #common ASV's that makes V different
ASV_list <- union(df1,df2)
ASV_list <- union(ASV_list,df3)
ASV_list <- union(ASV_list,df4)
ASV_list <- union(ASV_list,df5)
ASV_list <- union(ASV_list,df6)
phy_mrg <- merge_samples(subset_samples(phy_norm, Sample == "Soil"), group = "Soil", fun = "mean")
phy_mrg <- prune_taxa(ASV_list, phy_mrg)
phy_mrg <- otu_table(t(phy_mrg))
phy_mrg <- as.data.frame(phy_mrg)
phy_mrg[,"ASV"] <- rownames(phy_mrg)
phy_mrg[,"taxonomy"] <- taxonomy2[rownames(taxonomy2) %in% phy_mrg$ASV,]
phy_mrg[,"Order"] <- rowMeans(phy_mrg[,1:4],)
phy_mrg <- phy_mrg[order(phy_mrg$Order,decreasing = TRUE),]
max(phy_mrg[,1:4])
quantile_breaks <- function(xs, n = 10) {
breaks <- quantile(xs, probs = seq(0, 1, length.out = n))
breaks[!duplicated(breaks)]
}
mat_breaks <- quantile_breaks(as.matrix(phy_mrg[,1:4]), n = 100)
colors = colorRampPalette(c("white","goldenrod1","orange","orangered", "darkred"))(length(mat_breaks)-1)
colnames(phy_mrg)
col_ann = data.frame(
Soil=factor(c("La_Serena","Los_Angeles","Pozo_Almonte","Vicuna"
))
)
rownames(col_ann) = colnames(phy_mrg[,1:4])
pal = list(Soil = c("La_Serena" = "gold",
"Los_Angeles" = "orange",
"Vicuna" = "darkgoldenrod",
"Pozo_Almonte" = "brown")
)
pheatmap(phy_mrg[,c(1:4)], breaks=mat_breaks, col=colors,
angle_col = 45, cellwidth = 12,
cluster_cols = FALSE, cluster_rows = FALSE, annotation_col = col_ann,
annotation_colors = pal, fontsize_col=8, fontsize_row=8,
main = "Disimilarity fungal species",
labels_row = paste(phy_mrg$taxonomy,rownames(phy_mrg),sep = ",")
, annotation_legend = FALSE
, show_rownames = FALSE
, na_col = 'gray'
)
tmp <- prune_samples(!is.na(sample_data(subset_samples(phy_norm, Sample == "Soil"))$Specie), subset_samples(phy_norm, Sample == "Soil"))
adonis2(t(otu_table(tmp)) ~ Soil, data = data.frame(sample_data(subset_samples(phy_norm, Sample == "Soil"))))
pairwise.adonis2(t(otu_table(tmp))~Soil, data = data.frame(sample_data(tmp)))
phy_obj_B_Soil <- subset_samples(phy_obj_Bacteria, Sample == "Soil")
phy_BS_V <- subset_samples(phy_obj_B_Soil, Soil == "Vicuna")
phy_BS_LS <- subset_samples(phy_obj_B_Soil, Soil == "La_Serena")
phy_BS_LA <- subset_samples(phy_obj_B_Soil, Soil == "Los_Angeles")
phy_obj_B_Root <- subset_samples(phy_obj_Bacteria, Sample == "Root")
phy_BR_VPc <- subset_samples(phy_obj_B_Soil, Soil == "Vicuna")
phy_BR_VPc <- subset_samples(phy_BR_VPc, Specie == "P_chilensis")
phy_BR_LSPc <- subset_samples(phy_obj_B_Soil, Soil == "La_Serena")
phy_BR_LSPc <- subset_samples(phy_BR_LSPc, Specie == "P_chilensis")
phy_BR_LAPc <- subset_samples(phy_obj_B_Soil, Soil == "Los_Angeles")
phy_BR_LAPc <- subset_samples(phy_BR_LAPc, Specie == "P_chilensis")
phy_BR_VPt <- subset_samples(phy_obj_B_Soil, Soil == "Vicuna")
phy_BR_VPt <- subset_samples(phy_BR_VPt, Specie == "P_tamarugo")
phy_BR_LSPt <- subset_samples(phy_obj_B_Soil, Soil == "La_Serena")
phy_BR_LSPt <- subset_samples(phy_BR_LSPt, Specie == "P_tamarugo")
phy_BR_LAPt <- subset_samples(phy_obj_B_Soil, Soil == "Los_Angeles")
phy_BR_LAPt <- subset_samples(phy_BR_LAPt, Specie == "P_tamarugo")
phy_norm_B_Soil <- subset_samples(phy_norm, Sample == "Soil")
phy_norm_BS_mrg <- merge_samples(phy_norm_B_Soil, "Soil", fun = mean)
phy_norm_B_Root <- subset_samples(phy_norm, Sample == "Root")
sample_data(phy_norm_B_Root)[,"Soil_sp"] <- paste(sample_data(phy_norm_B_Root)$Soil, sample_data(phy_norm_B_Root)$Specie, sep = "_")
phy_norm_BR_mrg <- merge_samples(phy_norm_B_Root, "Soil_sp", fun = mean)
common_V_VPc <- intersect(rownames(otu_table(phy_BS_V)), rownames(otu_table(phy_BR_VPc)))
common_V_VPt <- intersect(rownames(otu_table(phy_BS_V)), rownames(otu_table(phy_BR_VPt)))
Root_Pc_V <- t(otu_table(phy_norm_BR_mrg))[colnames(otu_table(phy_norm_BR_mrg)) %in% common_V_VPc]
Root_Pc_V <- as.data.frame(as.matrix(Root_Pc_V)) %>% dplyr::select(Vicuna_P_chilensis)
Soil_Pc_V <- t(otu_table(phy_norm_BS_mrg))[colnames(otu_table(phy_norm_BS_mrg)) %in% common_V_VPc]
Soil_Pc_V <- as.data.frame(as.matrix(Soil_Pc_V)) %>% dplyr::select(Vicuna)
Root_Pt_V <- t(otu_table(phy_norm_BR_mrg))[colnames(otu_table(phy_norm_BR_mrg)) %in% common_V_VPt]
Root_Pt_V <- as.data.frame(as.matrix(Root_Pt_V)) %>% dplyr::select(Vicuna_P_tamarugo)
Soil_Pt_V <- t(otu_table(phy_norm_BS_mrg))[colnames(otu_table(phy_norm_BS_mrg)) %in% common_V_VPt]
Soil_Pt_V <- as.data.frame(as.matrix(Soil_Pt_V)) %>% dplyr::select(Vicuna)
P_tam_v <- merge(Soil_Pt_V, Root_Pt_V, by= "row.names")
rownames(P_tam_v) <- P_tam_v$Row.names
P_tam_v[,"ASVs"] <- P_tam_v$Row.names
P_tam_v$ASVs <- as.factor(P_tam_v$ASVs)
P_tam_v[,"Delta"] <- P_tam_v$Vicuna_P_tamarugo-P_tam_v$Vicuna
P_tam_v <- P_tam_v[,-1]
P_tam_v <- merge(P_tam_v,tax_table(phy_norm_BR_mrg), by = "row.names")
ggplot(P_tam_v, aes(Delta,ASVs, color = Delta)) +
theme_bw() +
theme(axis.text = element_blank()) +
scale_colour_gradient2(midpoint = 0, limits = c(-5, 3), low = "blue", mid = "gray", high = "red") +
geom_point() + geom_point(size = 5.5) + xlim(-5, 3) +
ggtitle("P. tamarugo recruitment Vicuña") +
scale_y_discrete(labels=paste(P_tam_v$Kingdom,P_tam_v$Phylum,P_tam_v$Class,P_tam_v$Order,P_tam_v$Family,P_tam_v$Genus,P_tam_v$Specie,P_tam_v$ASVs))
length(P_tam_v$Delta[P_tam_v$Delta==0])
length(P_tam_v$Delta[P_tam_v$Delta>0])
length(P_tam_v$Delta[P_tam_v$Delta<0])
P_chil_v <- merge(Soil_Pc_V, Root_Pc_V, by= "row.names")
rownames(P_chil_v) <- P_chil_v$Row.names
P_chil_v[,"ASVs"] <- P_chil_v$Row.names
P_chil_v$ASVs <- as.factor(P_chil_v$ASVs)
P_chil_v[,"Delta"] <- P_chil_v$Vicuna_P_chilensis-P_chil_v$Vicuna
P_chil_v <- P_chil_v[,-1]
P_chil_v <- merge(P_chil_v,tax_table(phy_norm_BR_mrg), by = "row.names")
ggplot(P_chil_v, aes(Delta,ASVs, color = Delta)) +
theme_bw() +
theme(axis.text = element_blank()) +
scale_colour_gradient2(midpoint = 0, limits = c(-5, 3), low = "blue", mid = "gray", high = "red") +
geom_point() + geom_point(size = 5.5) + xlim(-5, 3) +
ggtitle("P. chilensis recruitment Vicuña") +
scale_y_discrete(labels=paste(P_chil_v$Kingdom,P_chil_v$Phylum,P_chil_v$Class,P_chil_v$Order,P_chil_v$Family,P_chil_v$Genus,P_chil_v$Specie,P_chil_v$ASVs))
length(P_chil_v$Delta[P_chil_v$Delta==0])
length(P_chil_v$Delta[P_chil_v$Delta>0])
length(P_chil_v$Delta[P_chil_v$Delta<0])
df1 <- P_tam_v[order(abs(P_tam_v$Delta),decreasing = TRUE),] %>% head(30)
df2 <- P_chil_v[order(abs(P_chil_v$Delta),decreasing = TRUE),] %>% head(30)
df3 <- union(df1$Row.names,df2$Row.names)
df1 <- P_tam_v[P_tam_v$Row.names %in% df3,]
df2 <- P_chil_v[P_chil_v$Row.names %in% df3,]
p1 <- ggplot(df2, aes(Delta,ASVs, color = Delta)) +
theme_bw() +
scale_colour_gradient2(midpoint = 0, limits = c(-5, 3), low = "blue", mid = "gray", high = "red") +
geom_point() + geom_point(size = 5.5) + xlim(-5, 3) +
ggtitle("P. chilensis recruitment Vicuña") +
scale_y_discrete(labels=paste(df2$Kingdom,df2$Phylum,df2$Class,df2$Order,df2$Family,df2$Genus,df2$Specie,df2$ASVs))
p2 <- ggplot(df1, aes(Delta,ASVs, color = Delta)) +
theme_bw() +
scale_colour_gradient2(midpoint = 0, limits = c(-5, 3), low = "blue", mid = "gray", high = "red") +
geom_point() + geom_point(size = 5.5) + xlim(-5, 3) +
ggtitle("P. tamarugo recruitment Vicuña") +
scale_y_discrete(labels=paste(df1$Kingdom,df1$Phylum,df1$Class,df1$Order,df1$Family,df1$Genus,df1$Specie,df1$ASVs))
grid.arrange(p1, p2, ncol=2)
#higher than zero
P_tam_V_hz <- P_tam_v %>% filter(Delta > 0)
P_tam_V_hz <- P_tam_V_hz$Row.names
P_chil_v_hz <- P_chil_v %>% filter(Delta > 0)
P_chil_v_hz <- P_chil_v_hz$Row.names
plot.new()
suppressWarnings(grid.draw(venn.diagram(
list(P_tam_V_hz=P_tam_V_hz,P_chil_v_hz=P_chil_v_hz),
filename=NULL, col=c("yellowgreen","green"), margin=c(0.35,0.35,0.35,0.35),
category.names=c("P.tamarugo","P.chilensis"))))
#equal to zero
P_tam_V_ez <- P_tam_v %>% filter(Delta == 0)
P_tam_V_ez <- P_tam_V_ez$Row.names
P_chil_v_ez <- P_chil_v %>% filter(Delta == 0)
P_chil_v_ez <- P_chil_v_ez$Row.names
#lower than zero
P_tam_V_lz <- P_tam_v %>% filter(Delta < 0)
P_tam_V_lz <- P_tam_V_lz$Row.names
P_chil_v_lz <- P_chil_v %>% filter(Delta < 0)
P_chil_v_lz <- P_chil_v_lz$Row.names
common_V <- intersect(P_tam_V_hz, P_chil_v_hz)
common_V <- t(otu_table(phy_norm_BR_mrg))[colnames(otu_table(phy_norm_BR_mrg)) %in% common_V]
common_V <- as.data.frame(as.matrix(common_V))
common_V[,"Delta"] <- common_V$Vicuna_P_chilensis-common_V$Vicuna_P_tamarugo
common_V <- merge(common_V,tax_table(phy_norm_BR_mrg), by = "row.names")
rownames(common_V) <- common_V$Row.names
common_V <- common_V[,-1]
common_V[,"ASVs"] <- rownames(common_V)
ggplot(common_V, aes(Delta,ASVs, color = Delta)) +
theme_bw() +
theme(axis.text = element_blank()) +
scale_colour_gradient2(midpoint = 0, limits = c(-1, 1), low = "yellowgreen", mid = "gray", high = "green") +
geom_point() + geom_point(size = 5.5) + xlim(-1, 1) +
ggtitle("Common recruited Vicuña") +
scale_y_discrete(labels=paste(common_V$Kingdom,common_V$Phylum,common_V$Class,common_V$Order,common_V$Family,common_V$Genus,common_V$Specie,common_V$ASVs))
common_V2 <- common_V[order(abs(common_V$Delta),decreasing = TRUE),] %>% head(30)
ggplot(common_V2, aes(Delta,ASVs, color = Delta)) +
theme_bw() +
scale_colour_gradient2(midpoint = 0, limits = c(-1, 1), low = "yellowgreen", mid = "gray", high = "green") +
geom_point() + geom_point(size = 5.5) + xlim(-1, 1) +
ggtitle("Common recruited Vicuña") +
scale_y_discrete(labels=paste(common_V2$Kingdom,common_V2$Phylum,common_V2$Class,common_V2$Order,common_V2$Family,common_V2$Genus,common_V2$Specie,common_V2$ASVs))
common_LS_LSPc <- intersect(rownames(otu_table(phy_BS_LS)), rownames(otu_table(phy_BR_LSPc)))
common_LS_LSPt <- intersect(rownames(otu_table(phy_BS_LS)), rownames(otu_table(phy_BR_LSPt)))
Root_Pc_LS <- t(otu_table(phy_norm_BR_mrg))[colnames(otu_table(phy_norm_BR_mrg)) %in% common_LS_LSPc]
Root_Pc_LS <- as.data.frame(as.matrix(Root_Pc_LS)) %>% dplyr::select(La_Serena_P_chilensis)
Soil_Pc_LS <- t(otu_table(phy_norm_BS_mrg))[colnames(otu_table(phy_norm_BS_mrg)) %in% common_LS_LSPc]
Soil_Pc_LS <- as.data.frame(as.matrix(Soil_Pc_LS)) %>% dplyr::select(La_Serena)
Root_Pt_LS <- t(otu_table(phy_norm_BR_mrg))[colnames(otu_table(phy_norm_BR_mrg)) %in% common_LS_LSPt]
Root_Pt_LS <- as.data.frame(as.matrix(Root_Pt_LS)) %>% dplyr::select(La_Serena_P_tamarugo)
Soil_Pt_LS <- t(otu_table(phy_norm_BS_mrg))[colnames(otu_table(phy_norm_BS_mrg)) %in% common_LS_LSPt]
Soil_Pt_LS <- as.data.frame(as.matrix(Soil_Pt_LS)) %>% dplyr::select(La_Serena)
P_tam_LS <- merge(Soil_Pt_LS, Root_Pt_LS, by= "row.names")
rownames(P_tam_LS) <- P_tam_LS$Row.names
P_tam_LS[,"ASVs"] <- P_tam_LS$Row.names
P_tam_LS$ASVs <- as.factor(P_tam_LS$ASVs)
P_tam_LS[,"Delta"] <- P_tam_LS$La_Serena_P_tamarugo-P_tam_LS$La_Serena
P_tam_LS <- P_tam_LS[,-1]
P_tam_LS <- merge(P_tam_LS,tax_table(phy_norm_BR_mrg), by = "row.names")
ggplot(P_tam_LS, aes(Delta,ASVs, color = Delta)) +
theme_bw() +
theme(axis.text = element_blank()) +
scale_colour_gradient2(midpoint = 0, limits = c(-5, 3), low = "blue", mid = "gray", high = "red") +
geom_point() + geom_point(size = 5.5) + xlim(-5, 3) +
ggtitle("P. tamarugo recruitment La Serena") +
scale_y_discrete(labels=paste(P_tam_LS$Kingdom,P_tam_LS$Phylum,P_tam_LS$Class,P_tam_LS$Order,P_tam_LS$Family,P_tam_LS$Genus,P_tam_LS$Specie,P_tam_LS$ASVs))
length(P_tam_LS$Delta[P_tam_LS$Delta==0])
length(P_tam_LS$Delta[P_tam_LS$Delta>0])
length(P_tam_LS$Delta[P_tam_LS$Delta<0])
P_chil_LS <- merge(Soil_Pc_LS, Root_Pc_LS, by= "row.names")
rownames(P_chil_LS) <- P_chil_LS$Row.names
P_chil_LS[,"ASVs"] <- P_chil_LS$Row.names
P_chil_LS$ASVs <- as.factor(P_chil_LS$ASVs)
P_chil_LS[,"Delta"] <- P_chil_LS$La_Serena_P_chilensis-P_chil_LS$La_Serena
P_chil_LS <- P_chil_LS[,-1]
P_chil_LS <- merge(P_chil_LS,tax_table(phy_norm_BR_mrg), by = "row.names")
ggplot(P_chil_LS, aes(Delta,ASVs, color = Delta)) +
theme_bw() +
theme(axis.text = element_blank()) +
scale_colour_gradient2(midpoint = 0, limits = c(-5, 3), low = "blue", mid = "gray", high = "red") +
geom_point() + geom_point(size = 5.5) + xlim(-5, 3) +
ggtitle("P. chilensis recruitment La Serena") +
scale_y_discrete(labels=paste(P_chil_LS$Kingdom,P_chil_LS$Phylum,P_chil_LS$Class,P_chil_LS$Order,P_chil_LS$Family,P_chil_LS$Genus,P_chil_LS$Specie,P_chil_LS$ASVs))
length(P_chil_LS$Delta[P_chil_LS$Delta==0])
length(P_chil_LS$Delta[P_chil_LS$Delta>0])
length(P_chil_LS$Delta[P_chil_LS$Delta<0])
df1 <- P_tam_LS[order(abs(P_tam_LS$Delta),decreasing = TRUE),] %>% head(30)
df2 <- P_chil_LS[order(abs(P_chil_LS$Delta),decreasing = TRUE),] %>% head(30)
df3 <- union(df1$Row.names,df2$Row.names)
df1 <- P_tam_LS[P_tam_LS$Row.names %in% df3,]
df2 <- P_chil_LS[P_chil_LS$Row.names %in% df3,]
p1 <- ggplot(df2, aes(Delta,ASVs, color = Delta)) +
theme_bw() +
scale_colour_gradient2(midpoint = 0, limits = c(-5, 3), low = "blue", mid = "gray", high = "red") +
geom_point() + geom_point(size = 5.5) + xlim(-5, 3) +
ggtitle("P. chilensis recruitment La Serena") +
scale_y_discrete(labels=paste(df2$Kingdom,df2$Phylum,df2$Class,df2$Order,df2$Family,df2$Genus,df2$Specie,df2$ASVs))
p2 <- ggplot(df1, aes(Delta,ASVs, color = Delta)) +
theme_bw() +
scale_colour_gradient2(midpoint = 0, limits = c(-5, 3), low = "blue", mid = "gray", high = "red") +
geom_point() + geom_point(size = 5.5) + xlim(-5, 3) +
ggtitle("P. tamarugo recruitment La Serena") +
scale_y_discrete(labels=paste(df1$Kingdom,df1$Phylum,df1$Class,df1$Order,df1$Family,df1$Genus,df1$Specie,df1$ASVs))
grid.arrange(p1, p2, ncol=2)
#higher than zero
P_tam_LS_hz <- P_tam_LS %>% filter(Delta > 0)
P_tam_LS_hz <- P_tam_LS_hz$Row.names
P_chil_LS_hz <- P_chil_LS %>% filter(Delta > 0)
P_chil_LS_hz <- P_chil_LS_hz$Row.names
plot.new()
suppressWarnings(grid.draw(venn.diagram(
list(P_tam_LS_hz=P_tam_LS_hz,P_chil_LS_hz=P_chil_LS_hz),
filename=NULL, col=c("yellowgreen","green"), margin=c(0.35,0.35,0.35,0.35),
category.names=c("P.tamarugo","P.chilensis"))))
#equal to zero
P_tam_LS_ez <- P_tam_LS %>% filter(Delta == 0)
P_tam_LS_ez <- P_tam_LS_ez$Row.names
P_chil_LS_ez <- P_chil_LS %>% filter(Delta == 0)
P_chil_LS_ez <- P_chil_LS_ez$Row.names
#equal to zero
P_tam_LS_lz <- P_tam_LS %>% filter(Delta < 0)
P_tam_LS_lz <- P_tam_LS_lz$Row.names
P_chil_LS_lz <- P_chil_LS %>% filter(Delta < 0)
P_chil_LS_lz <- P_chil_LS_lz$Row.names
common_LS <- intersect(P_tam_LS_hz, P_chil_LS_hz)
common_LS <- t(otu_table(phy_norm_BR_mrg))[colnames(otu_table(phy_norm_BR_mrg)) %in% common_LS]
common_LS <- as.data.frame(as.matrix(common_LS))
common_LS[,"Delta"] <- common_LS$Vicuna_P_chilensis-common_LS$Vicuna_P_tamarugo
common_LS <- merge(common_LS,tax_table(phy_norm_BR_mrg), by = "row.names")
rownames(common_LS) <- common_LS$Row.names
common_LS <- common_LS[,-1]
common_LS[,"ASVs"] <- rownames(common_LS)
ggplot(common_LS, aes(Delta,ASVs, color = Delta)) +
theme_bw() +
theme(axis.text = element_blank()) +
scale_colour_gradient2(midpoint = 0, limits = c(-1, 1), low = "yellowgreen", mid = "gray", high = "green") +
geom_point() + geom_point(size = 5.5) + xlim(-1, 1) +
ggtitle("Common recruited Vicuña") +
scale_y_discrete(labels=paste(common_LS$Kingdom,common_LS$Phylum,common_LS$Class,common_LS$Order,common_LS$Family,common_LS$Genus,common_LS$Specie,common_LS$ASVs))
common_LS2 <- common_LS[order(abs(common_LS$Delta),decreasing = TRUE),] %>% head(30)
ggplot(common_LS2, aes(Delta,ASVs, color = Delta)) +
theme_bw() +
scale_colour_gradient2(midpoint = 0, limits = c(-1, 1), low = "yellowgreen", mid = "gray", high = "green") +
geom_point() + geom_point(size = 5.5) + xlim(-1, 1) +
ggtitle("Common recruited Vicuña") +
scale_y_discrete(labels=paste(common_LS2$Kingdom,common_LS2$Phylum,common_LS2$Class,common_LS2$Order,common_LS2$Family,common_LS2$Genus,common_LS2$Specie,common_LS2$ASVs))
common_LA_LAPc <- intersect(rownames(otu_table(phy_BS_LA)), rownames(otu_table(phy_BR_LAPc)))
common_LA_LAPt <- intersect(rownames(otu_table(phy_BS_LA)), rownames(otu_table(phy_BR_LAPt)))
Root_Pc_LA <- t(otu_table(phy_norm_BR_mrg))[colnames(otu_table(phy_norm_BR_mrg)) %in% common_LA_LAPc]
Root_Pc_LA <- as.data.frame(as.matrix(Root_Pc_LA)) %>% dplyr::select(Los_Angeles_P_chilensis)
Soil_Pc_LA <- t(otu_table(phy_norm_BS_mrg))[colnames(otu_table(phy_norm_BS_mrg)) %in% common_LA_LAPc]
Soil_Pc_LA <- as.data.frame(as.matrix(Soil_Pc_LA)) %>% dplyr::select(Los_Angeles)
Root_Pt_LA <- t(otu_table(phy_norm_BR_mrg))[colnames(otu_table(phy_norm_BR_mrg)) %in% common_LA_LAPt]
Root_Pt_LA <- as.data.frame(as.matrix(Root_Pt_LA)) %>% dplyr::select(Los_Angeles_P_tamarugo)
Soil_Pt_LA <- t(otu_table(phy_norm_BS_mrg))[colnames(otu_table(phy_norm_BS_mrg)) %in% common_LA_LAPt]
Soil_Pt_LA <- as.data.frame(as.matrix(Soil_Pt_LA)) %>% dplyr::select(Los_Angeles)
P_tam_LA <- merge(Soil_Pt_LA, Root_Pt_LA, by= "row.names")
rownames(P_tam_LA) <- P_tam_LA$Row.names
P_tam_LA[,"ASVs"] <- P_tam_LA$Row.names
P_tam_LA$ASVs <- as.factor(P_tam_LA$ASVs)
P_tam_LA[,"Delta"] <- P_tam_LA$Los_Angeles_P_tamarugo-P_tam_LA$Los_Angeles
P_tam_LA <- P_tam_LA[,-1]
P_tam_LA <- merge(P_tam_LA,tax_table(phy_norm_BR_mrg), by = "row.names")
ggplot(P_tam_LA, aes(Delta,ASVs, color = Delta)) +
theme_bw() +
theme(axis.text = element_blank()) +
scale_colour_gradient2(midpoint = 0, limits = c(-5, 3), low = "blue", mid = "gray", high = "red") +
geom_point() + geom_point(size = 5.5) + xlim(-5, 3) +
ggtitle("P. tamarugo recruitment Los Angeles") +
scale_y_discrete(labels=paste(P_tam_LA$Kingdom,P_tam_LA$Phylum,P_tam_LA$Class,P_tam_LA$Order,P_tam_LA$Family,P_tam_LA$Genus,P_tam_LA$Specie,P_tam_LA$ASVs))
length(P_tam_LA$Delta[P_tam_LA$Delta==0])
length(P_tam_LA$Delta[P_tam_LA$Delta>0])
length(P_tam_LA$Delta[P_tam_LA$Delta<0])
P_chil_LA <- merge(Soil_Pc_LA, Root_Pc_LA, by= "row.names")
rownames(P_chil_LA) <- P_chil_LA$Row.names
P_chil_LA[,"ASVs"] <- P_chil_LA$Row.names
P_chil_LA$ASVs <- as.factor(P_chil_LA$ASVs)
P_chil_LA[,"Delta"] <- P_chil_LA$Los_Angeles_P_chilensis-P_chil_LA$Los_Angeles
P_chil_LA <- P_chil_LA[,-1]
P_chil_LA <- merge(P_chil_LA,tax_table(phy_norm_BR_mrg), by = "row.names")
ggplot(P_chil_LA, aes(Delta,ASVs, color = Delta)) +
theme_bw() +
theme(axis.text = element_blank()) +
scale_colour_gradient2(midpoint = 0, limits = c(-5, 3), low = "blue", mid = "gray", high = "red") +
geom_point() + geom_point(size = 5.5) + xlim(-5, 3) +
ggtitle("P. chilensis recruitment Los Angeles") +
scale_y_discrete(labels=paste(P_chil_LA$Kingdom,P_chil_LA$Phylum,P_chil_LA$Class,P_chil_LA$Order,P_chil_LA$Family,P_chil_LA$Genus,P_chil_LA$Specie,P_chil_LA$ASVs))
length(P_chil_LA$Delta[P_chil_LA$Delta==0])
length(P_chil_LA$Delta[P_chil_LA$Delta>0])
length(P_chil_LA$Delta[P_chil_LA$Delta<0])
df1 <- P_tam_LA[order(abs(P_tam_LA$Delta),decreasing = TRUE),] %>% head(30)
df2 <- P_chil_LA[order(abs(P_chil_LA$Delta),decreasing = TRUE),] %>% head(30)
df3 <- union(df1$Row.names,df2$Row.names)
df1 <- P_tam_LA[P_tam_LA$Row.names %in% df3,]
df2 <- P_chil_LA[P_chil_LA$Row.names %in% df3,]
p1 <- ggplot(df2, aes(Delta,ASVs, color = Delta)) +
theme_bw() +
scale_colour_gradient2(midpoint = 0, limits = c(-5, 3), low = "blue", mid = "gray", high = "red") +
geom_point() + geom_point(size = 5.5) + xlim(-5, 3) +
ggtitle("P. chilensis recruitment Los Angeles") +
scale_y_discrete(labels=paste(df2$Kingdom,df2$Phylum,df2$Class,df2$Order,df2$Family,df2$Genus,df2$Specie,df2$ASVs))
p2 <- ggplot(df1, aes(Delta,ASVs, color = Delta)) +
theme_bw() +
scale_colour_gradient2(midpoint = 0, limits = c(-5, 3), low = "blue", mid = "gray", high = "red") +
geom_point() + geom_point(size = 5.5) + xlim(-5, 3) +
ggtitle("P. tamarugo recruitment Los Angeles") +
scale_y_discrete(labels=paste(df1$Kingdom,df1$Phylum,df1$Class,df1$Order,df1$Family,df1$Genus,df1$Specie,df1$ASVs))
grid.arrange(p1, p2, ncol=2)
#higher than zero
P_tam_LA_hz <- P_tam_LA %>% filter(Delta > 0)
P_tam_LA_hz <- P_tam_LA_hz$Row.names
P_chil_LA_hz <- P_chil_LA %>% filter(Delta > 0)
P_chil_LA_hz <- P_chil_LA_hz$Row.names
#pdf("Manuscript/Plots/Supplementary/Venn_LA_Bacteria_hz.pdf", width = 10, height = 10)
plot.new()
suppressWarnings(grid.draw(venn.diagram(
list(P_tam_LA_hz=P_tam_LA_hz,P_chil_LA_hz=P_chil_LA_hz),
filename=NULL, col=c("yellowgreen","green"), margin=c(0.35,0.35,0.35,0.35),
category.names=c("P.tamarugo","P.chilensis"))))
#dev.off()
#equal to zero
P_tam_LA_ez <- P_tam_LA %>% filter(Delta == 0)
P_tam_LA_ez <- P_tam_LA_ez$Row.names
P_chil_LA_ez <- P_chil_LA %>% filter(Delta == 0)
P_chil_LA_ez <- P_chil_LA_ez$Row.names
#lower than zero
P_tam_LA_lz <- P_tam_LA %>% filter(Delta < 0)
P_tam_LA_lz <- P_tam_LA_lz$Row.names
P_chil_LA_lz <- P_chil_LA %>% filter(Delta < 0)
P_chil_LA_lz <- P_chil_LA_lz$Row.names
common_LA <- intersect(P_tam_LA_hz, P_chil_LA_hz)
common_LA <- t(otu_table(phy_norm_BR_mrg))[colnames(otu_table(phy_norm_BR_mrg)) %in% common_LA]
common_LA <- as.data.frame(as.matrix(common_LA))
common_LA[,"Delta"] <- common_LA$Vicuna_P_chilensis-common_LA$Vicuna_P_tamarugo
common_LA <- merge(common_LA,tax_table(phy_norm_BR_mrg), by = "row.names")
rownames(common_LA) <- common_LA$Row.names
common_LA <- common_LA[,-1]
common_LA[,"ASVs"] <- rownames(common_LA)
ggplot(common_LA, aes(Delta,ASVs, color = Delta)) +
theme_bw() +
theme(axis.text = element_blank()) +
scale_colour_gradient2(midpoint = 0, limits = c(-1, 1), low = "yellowgreen", mid = "gray", high = "green") +
geom_point() + geom_point(size = 5.5) + xlim(-1, 1) +
ggtitle("Common recruited Vicuña") +
scale_y_discrete(labels=paste(common_LA$Kingdom,common_LA$Phylum,common_LA$Class,common_LA$Order,common_LA$Family,common_LA$Genus,common_LA$Specie,common_LA$ASVs))
common_LA2 <- common_LA[order(abs(common_LA$Delta),decreasing = TRUE),] %>% head(30)
ggplot(common_LA2, aes(Delta,ASVs, color = Delta)) +
theme_bw() +
scale_colour_gradient2(midpoint = 0, limits = c(-1, 1), low = "yellowgreen", mid = "gray", high = "green") +
geom_point() + geom_point(size = 5.5) + xlim(-1, 1) +
ggtitle("Common recruited Vicuña") +
scale_y_discrete(labels=paste(common_LA2$Kingdom,common_LA2$Phylum,common_LA2$Class,common_LA2$Order,common_LA2$Family,common_LA2$Genus,common_LA2$Specie,common_LA2$ASVs))
sessionInfo()
common_LA
common_LS
common_LS
common_LA
common_LA <- intersect(P_tam_LA_hz, P_chil_LA_hz)
common_LA <- t(otu_table(phy_norm_FR_mrg))[colnames(otu_table(phy_norm_FR_mrg)) %in% common_LA]
common_LA <- intersect(P_tam_LA_hz, P_chil_LA_hz)
common_LA <- t(otu_table(phy_norm_BR_mrg))[colnames(otu_table(phy_norm_BR_mrg)) %in% common_LA]
common_LA <- as.data.frame(as.matrix(common_LA))
common_LA[,"Delta"] <- common_LA$Los_Angeles_P_chilensis-common_LA$Los_Angeles_P_tamarugo
common_LA <- merge(common_LA,tax_table(phy_norm_BR_mrg), by = "row.names")
rownames(common_LA) <- common_LA$Row.names
common_LA <- common_LA[,-1]
common_LA[,"ASVs"] <- rownames(common_LA)
ggplot(common_LA, aes(Delta,ASVs, color = Delta)) +
theme_bw() +
theme(axis.text = element_blank()) +
scale_colour_gradient2(midpoint = 0, limits = c(-1, 1), low = "yellowgreen", mid = "gray", high = "green") +
geom_point() + geom_point(size = 5.5) + xlim(-1, 1) +
ggtitle("Common recruited Vicuña") +
scale_y_discrete(labels=paste(common_LA$Kingdom,common_LA$Phylum,common_LA$Class,common_LA$Order,common_LA$Family,common_LA$Genus,common_LA$Specie,common_LA$ASVs))
common_LA2 <- common_LA[order(abs(common_LA$Delta),decreasing = TRUE),] %>% head(30)
ggplot(common_LA2, aes(Delta,ASVs, color = Delta)) +
theme_bw() +
scale_colour_gradient2(midpoint = 0, limits = c(-1, 1), low = "yellowgreen", mid = "gray", high = "green") +
geom_point() + geom_point(size = 5.5) + xlim(-1, 1) +
ggtitle("Common recruited Los angeles") +
scale_y_discrete(labels=paste(common_LA2$Kingdom,common_LA2$Phylum,common_LA2$Class,common_LA2$Order,common_LA2$Family,common_LA2$Genus,common_LA2$Specie,common_LA2$ASVs))
